import fetch from 'node-fetch';

const { log } = console;

export const buildParameters = (token, method, body) => ({
  method,
  headers: {
    Authorization: `token ${token}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(body),
});

export const githubRequest = (token, url, method = 'GET', body = {}) =>
  fetch(url, buildParameters(token, method, body))
    .then(response => {
      const data = response.json();

      if (response.status >= 400) {
        return data.then(message => {
          log('Github request error', message);

          return [];
        });
      }

      return data;
    })
    .catch(error => log('Github request error', error));
