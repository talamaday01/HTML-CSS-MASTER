'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.githubRequest = exports.buildParameters = undefined;

var _nodeFetch = require('node-fetch');

var _nodeFetch2 = _interopRequireDefault(_nodeFetch);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const { log } = console;

const buildParameters = exports.buildParameters = (token, method, body) => ({
  method,
  headers: {
    Authorization: `token ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(body)
});

const githubRequest = exports.githubRequest = (token, url, method = 'GET', body = {}) => (0, _nodeFetch2.default)(url, buildParameters(token, method, body)).then(response => {
  const data = response.json();

  if (response.status >= 400) {
    return data.then(message => {
      log('Github request error', message);

      return [];
    });
  }

  return data;
}).catch(error => log('Github request error', error));